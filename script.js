!function a(n,o,s){function i(t,e){if(!o[t]){if(!n[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(c)return c(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}r=o[t]={exports:{}},n[t][0].call(r.exports,function(e){return i(n[t][1][e]||e)},r,r.exports,a,n,o,s)}return o[t].exports}for(var c="function"==typeof require&&require,e=0;e<s.length;e++)i(s[e]);return i}({1:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getLeafStates=function(e){var t={};for(const r of n(e))t[r.id.replaceAll("_"," ")]=r.checked;return t},r.makeCheckboxTree=function(e){e=function t(r){{if("string"==typeof r){let e=!1,t=("-"===r[0]&&(r=r.substring(1),e=!0),!1);"+"===r[0]&&(r=r.substring(1),t=!0);const a=(0,s.createHTML)(["li",["input",{type:"checkbox",id:r.replaceAll(" ","_"),...t&&{checked:"checked"}}],["label",{for:r.replaceAll(" ","_")},r]]);return e&&a.classList.add("disabled"),a}{const n=(0,s.createHTML)(["ul",{class:"checkbox"}]);for(let e=0;e<r.length;e++){const o=r[e];n.appendChild(t(o))}return(0,s.createHTML)(["li",n])}}}(e).children[0];if(!(e instanceof HTMLUListElement))throw"Internal error";!function e(t){for(const r of t.children)r instanceof HTMLLIElement?a(r.children[0]):r instanceof HTMLUListElement&&e(r)}(e);for(const t of n(e))i(t);return e},r.setLeafStates=function(e,t){for(const a of n(e)){var r=t[a.id.replaceAll("_"," ")];void 0!==r&&(a.checked=r,i(a))}};var s=e("./html");function o(e){var t=e.parentElement;if(t instanceof HTMLLIElement){var r=t.parentElement;if(r instanceof HTMLUListElement)for(let e=0;e<r.children.length;e++)if(r.children[e]===t){var a=r.children[e+1]?.children[0];if(a instanceof HTMLUListElement)return Array.from(a.children).filter(e=>e instanceof HTMLLIElement&&e.children[0]instanceof HTMLInputElement).map(e=>e.children[0]);break}}return[]}function i(a){a=function(t){var r=t.parentElement?.parentElement?.parentElement;if(r instanceof HTMLLIElement){t=r.parentElement;if(t instanceof HTMLUListElement){let e;for(const a of t.children)if(a instanceof HTMLLIElement&&a.children[0]instanceof HTMLInputElement)e=a;else if(a===r&&e)return e.children[0]}}}(a);if(a){let e=!1,t=!1,r=!1;for(const n of o(a))n.checked?e=!0:t=!0,n.indeterminate&&(r=!0);r||e&&t?a.indeterminate=!0:e?(a.checked=!0,a.indeterminate=!1):t&&(a.checked=!1,a.indeterminate=!1),i(a)}}function a(e){e.addEventListener("change",e=>{e=e.target;e instanceof HTMLInputElement&&(!function e(t){for(const r of o(t))r.checked!==t.checked&&(r.checked=t.checked,r.indeterminate=!1,e(r))}(e),i(e))})}function n(e){let t=[];for(const a of e.children){var r=a.children[0];r instanceof HTMLInputElement?0===o(r).length&&t.push(r):r instanceof HTMLUListElement&&(t=t.concat(n(r)))}return t}},{"./html":2}],2:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createHTML=function r(t){const a=document.createElement(t[0]);function n(e){if("string"==typeof e||e instanceof HTMLElement)a.append(e);else if(Array.isArray(e))a.append(r(e));else for(const t in e)a.setAttribute(t,e[t])}for(let e=1;e<t.length;e++)n(t[e]);return a}},{}],3:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.characters=r.ShopItemSource=r.ItemSource=r.Item=r.GuardianItemSource=r.GachaItemSource=void 0,r.createPopupLink=_,r.download=p,r.downloadItems=async function(){var e=document.getElementById("progressbar");e instanceof HTMLProgressElement&&(e.value=0,e.max=122);const t=p("https://raw.githubusercontent.com/sstokic-tgm/JFTSE/development/auth-server/src/main/resources/res/Item_Parts_Ini3.xml"),r=[...Array(20).keys()].map(e=>p("https://jftse.com/api/v1/shop?size=1000&page="+e)),a=p("https://raw.githubusercontent.com/sstokic-tgm/JFTSE/development/emulator/src/main/resources/res//GuardianStages.json");(function(e){e.length<1e3&&console.warn(`Items file is only ${e.length} bytes long`);for(var[,t]of e.matchAll(/\<Item (.*)\/\>/g)){var r,a,n=new d;for([,r,a]of t.matchAll(/\s?([^=]*)="([^"]*)"/g))switch(r){case"Index":n.id=parseInt(a);break;case"_Name_":n.name_kr=a;break;case"Name_N":n.name_en=a;break;case"UseType":n.useType=a;break;case"MaxUse":n.maxUse=parseInt(a);break;case"Hide":n.hidden=!!parseInt(a);break;case"Resist":n.resist=a;break;case"Char":switch(a){case"NIKI":n.character="Niki";break;case"LUNLUN":n.character="LunLun";break;case"LUCY":n.character="Lucy";break;case"SHUA":n.character="Shua";break;case"DHANPIR":n.character="Dhanpir";break;case"POCHI":n.character="Pochi";break;case"AL":n.character="Al";break;default:console.warn(`Found unknown character "${a}"`)}break;case"Part":switch(String(a)){case"BAG":n.part="Backpack";break;case"GLASSES":n.part="Face";break;case"HAND":n.part="Hand";break;case"SOCKS":n.part="Socks";break;case"FOOT":n.part="Shoes";break;case"CAP":n.part="Hat";break;case"PANTS":n.part="Lower";break;case"RACKET":n.part="Racket";break;case"BODY":n.part="Upper";break;case"HAIR":n.part="Hair";break;case"DYE":n.part="Dye";break;default:console.warn("Found unknown part "+a)}break;case"Level":n.level=parseInt(a);break;case"STR":n.str=parseInt(a);break;case"STA":n.sta=parseInt(a);break;case"DEX":n.dex=parseInt(a);break;case"WIL":n.wil=parseInt(a);break;case"AddHP":n.hp=parseInt(a);break;case"AddQuick":n.quickslots=parseInt(a);break;case"AddBuff":n.buffslots=parseInt(a);break;case"SmashSpeed":n.smash=parseInt(a);break;case"MoveSpeed":n.movement=parseInt(a);break;case"ChargeshotSpeed":n.charge=parseInt(a);break;case"LobSpeed":n.lob=parseInt(a);break;case"ServeSpeed":n.serve=parseInt(a);break;case"MAX_STR":n.max_str=Math.max(parseInt(a),n.str);break;case"MAX_STA":n.max_sta=Math.max(parseInt(a),n.sta);break;case"MAX_DEX":n.max_dex=Math.max(parseInt(a),n.dex);break;case"MAX_WIL":n.max_wil=Math.max(parseInt(a),n.wil);break;case"EnchantElement":n.element_enchantable=!!parseInt(a);break;case"EnableParcel":n.parcel_enabled=!!parseInt(a);break;case"BallSpin":n.spin=parseInt(a);break;case"ATSS":n.atss=parseInt(a);break;case"DFSS":n.dfss=parseInt(a);break;case"Socket":n.socket=parseInt(a);break;case"Gauge":n.gauge=parseInt(a);break;case"GaugeBattle":n.gauge_battle=parseInt(a);break;default:console.warn(`Found unknown item attribute "${r}"`)}k.set(n.id,n)}})(await t),await Promise.all(r.map(e=>e.then(e=>{var t=e;for(const o of JSON.parse(t))if(function(e){return null!==e&&"object"==typeof e&&["number"==typeof e.productIndex,"number"==typeof e.display,"boolean"==typeof e.hitDisplay,"boolean"==typeof e.enabled,"string"==typeof e.useType,"number"==typeof e.use0,"number"==typeof e.use1,"number"==typeof e.use2,"string"==typeof e.priceType,"number"==typeof e.oldPrice0,"number"==typeof e.oldPrice1,"number"==typeof e.oldPrice2,"number"==typeof e.price0,"number"==typeof e.price1,"number"==typeof e.price2,"number"==typeof e.couplePrice,"string"==typeof e.category,"string"==typeof e.name,"number"==typeof e.goldBack,"boolean"==typeof e.enableParcel,"number"==typeof e.forPlayer,"number"==typeof e.item0,"number"==typeof e.item1,"number"==typeof e.item2,"number"==typeof e.item3,"number"==typeof e.item4,"number"==typeof e.item5,"number"==typeof e.item6,"number"==typeof e.item7,"number"==typeof e.item8,"number"==typeof e.item9].every(e=>e)}(o)){var r,a=[o.item0,o.item1,o.item2,o.item3,o.item4,o.item5,o.item6,o.item7,o.item8,o.item9].filter(e=>!!e&&k.get(e)).map(e=>k.get(e));if("PARTS"===o.category){if(1===a.length?m.set(o.productIndex,a[0]):((r=new d).name_en=o.name,m.set(o.productIndex,r)),o.enabled){var n=new T(o.productIndex,o.price0,"MINT"===o.priceType,a);for(const s of a)s.sources.push(n)}}else"LOTTERY"===o.category?(b.set(o.productIndex,new u(o.productIndex,o.item0,o.name)),(r=new d).name_en=o.name,m.set(o.productIndex,r),o.enabled&&r.sources.push(new T(o.productIndex,o.price0,"MINT"===o.priceType,a))):((a=new d).name_en=o.name,m.set(o.productIndex,a))}else console.error("Incorrect format of item: "+t)}))),console.log(`Found ${b.size} gachas`),e instanceof HTMLProgressElement&&(e.value=0,e.max=b.size+3);var n=[];for(var[,o]of b){var s=`https://raw.githubusercontent.com/sstokic-tgm/JFTSE/development/game-server/src/main/resources/res/lottery/Ini3_Lot_${(""+o.gacha_index).padStart(2,"0")}.xml`;n.push([p(s),o,s])}!function(e){e=JSON.parse(e);if(Array.isArray(e)){var t=new Map;for(const l of e)if("object"==typeof l){var r=l.Name;if("string"==typeof r){var a=(Array.isArray(l.Rewards)?[...l.Rewards]:[]).filter(e=>"number"==typeof e&&m.has(e)).map(e=>m.get(e)),n=c(l.ExpMultiplier)||0,o=!!l.IsBossStage,s=c(l.MapId)||0;let e=c(l.BossTriggerTimerInSeconds)||-1;-1===e?e=t.get(s)||-1:0!==s&&t.set(s,e);for(const d of a){var i=new x(r,a,n,o,e);d.sources.push(i)}}}function c(e){if("number"==typeof e)return e}}}(await a);for(var[i,c,l]of n)try{!function(e,t){for(const s of e.split("\n"))if(s.includes("<LotteryItem_")){var r,a=s.match(/\s*<LotteryItem_(?<character>[^ ]*) Index="\d+" _Name_="[^"]*" ShopIndex="(?<shop_id>\d+)" QuantityMin="(?<quantity_min>\d+)" QuantityMax="(?<quantity_max>\d+)" ChansPer="(?<probability>\d+\.?\d*)\s*" Effect="\d+" ProductOpt="\d+"\/>/);if(a){if(a.groups){let e=a.groups.character;E(e="Lunlun"===e?"LunLun":e)?(r=m.get(parseInt(a.groups.shop_id)))?t.add(r,parseFloat(a.groups.probability),e,parseInt(a.groups.quantity_min),parseInt(a.groups.quantity_max)):console.warn(`Found unknown shop item id ${a.groups.shop_id} in lottery file `+t.gacha_index):console.warn(`Found unknown character "${e}" in lottery file `+t.gacha_index)}}else console.warn(`Failed parsing gacha ${t.gacha_index}:
`+s)}for(var[,n]of t.shop_items)for(var[o]of n)o.sources.push(new M(t.shop_index))}(await i,c)}catch(e){console.warn(`Failed downloading ${l} because `+e)}console.log(`Loaded ${k.size} items`)},r.getGachaTable=function(e,t){var r=(0,I.createHTML)(["table",["tr",["th",{class:"Name_column"},"Name"]]]);for(var[,a]of b){var n=m.get(a.shop_index);if(!n)throw"Internal error";e(n)&&r.appendChild((0,I.createHTML)(["tr",["td",l(void 0,new o(a.shop_index),t)]]))}return r},r.getMaxItemLevel=function(){let e=0;for(var[,t]of k)e=Math.max(e,t.level);return e},r.getResultsTable=function(e,t,r,a,n){var o={Hat:[],Hair:[],Dye:[],Upper:[],Lower:[],Shoes:[],Socks:[],Hand:[],Backpack:[],Face:[],Racket:[]};for(var[,s]of k)e(s)&&(o[s.part]=r(o[s.part],s));var i=(0,I.createHTML)(["table",["tr",["th",{class:"Name_column"},"Name"],["th",{class:"Character_column"},"Character"],["th",{class:"Part_column"},"Part"],...a.map(e=>(0,I.createHTML)(["th",{class:"numeric"},e])),["th",{class:"Level_column numeric"},"Level"],["th",{class:"Source_column"},"Source"]]]);function c(e,t){return{gold:e.gold+t.gold,ap:e.ap+t.ap,maps:function(e,t){var r,a,n={...e};for([r,a]of Object.entries(t))n[r]?n[r]=n[r].concat(a):n[r]=a;return n}(e.maps,t.maps)}}function l(e,t){var r,a,n={...e};for([r,a]of Object.entries(t)){if(1!==a.length)throw"Internal error";n[r]?n[r]=[Math.min(n[r][0],a[0])]:n[r]=a}return n}function d(a,n){return[...a.sources.values()].filter(t).reduce((e,t)=>{var r=(()=>{if(t instanceof T)return t.ap?{gold:0,ap:t.price,maps:{}}:{gold:t.price,ap:0,maps:{}};if(t instanceof M){var e=d(t.item,n);const r=t.gachaTries(a,n);return{gold:e.gold*r,ap:e.ap*r,maps:Object.fromEntries(Object.entries(e.maps).map(([e,t])=>[e,t.map(e=>e*r)]))}}if(t instanceof x)return{gold:0,ap:0,maps:Object.fromEntries([[t.guardian_map,[t.items.length]]])};throw"Internal error"})();return r=r,[(e=e).ap,e.gold]<[e.ap,e.gold]?{gold:e.gold,ap:e.ap,maps:l(e.maps,r.maps)}:{gold:r.gold,ap:r.ap,maps:l(e.maps,r.maps)}},{gold:0,ap:0,maps:{}})}const u={characters:new Set,...a.reduce((e,t)=>({...e,[t]:0}),{}),Level:0,cost:{ap:0,gold:0,maps:{}}};for(const f of Object.values(o))if(0!==f.length){for(const h of a){var m;"number"==typeof u[h]&&(m=h.split("+").reduce((e,t)=>e+f[0].statFromString(t),0),u[h]+=m)}u.Level=Math.max(f[0].level,u.Level);for(const g of f){for(const b of g.character?[g.character]:y)u.characters.add(b),i.appendChild(function(t,e,r,a){r=(0,I.createHTML)(["tr",["td",{class:"Name_column"},function(e,t){return(0,I.createHTML)(["div",(0,I.createHTML)(["button",{class:"item_removal","data-item_index":""+t},"X"]),e])}(t.name_en,t.id)],["td",{class:"Character_column"},t.character??"All"],["td",{class:"Part_column"},t.part],...r.map(e=>(0,I.createHTML)(["td",{class:"numeric"},e.split("+").map(e=>t.statFromString(e)).join("+")])),["td",{class:"Level_column numeric"},""+t.level],["td",{class:"Source_column"},...w(S(t,e,a))]]);return r}(g,t,a,b));u.cost=c(d(g,n&&E(n)?n:void 0),u.cost)}}if(1===u.characters.size){var p=[];0<u.cost.gold&&p.push(u.cost.gold.toFixed(0)+" Gold"),0<u.cost.ap&&p.push(u.cost.ap.toFixed(0)+" AP"),i.appendChild((0,I.createHTML)(["tr",["td",{class:"total Name_column"},"Total:"],["td",{class:"total Character_column"}],["td",{class:"total Part_column"}],...a.map(e=>(0,I.createHTML)(["td",{class:"total numeric"},""+u[e]])),["td",{class:"total Level_column numeric"},""+u.Level],["td",{class:"total Source_column"},p.join(", ")]]));for(const v of i.getElementsByClassName("Character_column"))v instanceof HTMLElement&&(v.hidden=!0)}for(const _ of a)if(0===u[_])for(const L of i.getElementsByClassName(_+"_column"))L instanceof HTMLElement&&(L.hidden=!0);return i},r.isCharacter=E,r.shop_items=r.items=void 0;var I=e("./html");const y=["Niki","LunLun","Lucy","Shua","Dhanpir","Pochi","Al"];function E(e){return y.includes(e)}r.characters=y;class o{shop_id;constructor(e){this.shop_id=e}get requiresGuardian(){if(this instanceof T)return!1;if(this instanceof M)return[...this.item.sources.values()].every(e=>e.requiresGuardian);if(this instanceof x)return!0;throw"Internal error"}get item(){var e=m.get(this.shop_id);if(e)return e;throw console.error("Failed finding item of itemSource "+this.shop_id),"Internal error"}}class T extends(r.ItemSource=o){price;ap;items;constructor(e,t,r,a){super(e),this.price=t,this.ap=r,this.items=a}}r.ShopItemSource=T;class M extends o{constructor(e){super(e)}gachaTries(e,t){var r=b.get(this.shop_id);if(r)return r.average_tries(e,t);throw"Internal error"}}r.GachaItemSource=M;class x extends o{guardian_map;items;xp;need_boss;boss_time;constructor(e,t,r,a,n){super(x.guardian_map_id(e)),this.guardian_map=e,this.items=t,this.xp=r,this.need_boss=a,this.boss_time=n}static guardian_map_id(e){let t=this.guardian_maps.indexOf(e);return-1===t&&(t=this.guardian_maps.length,this.guardian_maps.push(e)),-t}static guardian_maps=[""]}r.GuardianItemSource=x;class d{id=0;name_kr="";name_en="";useType="";maxUse=0;hidden=!1;resist="";character;part="Other";level=0;str=0;sta=0;dex=0;wil=0;hp=0;quickslots=0;buffslots=0;smash=0;movement=0;charge=0;lob=0;serve=0;max_str=0;max_sta=0;max_dex=0;max_wil=0;element_enchantable=!1;parcel_enabled=!1;parcel_from_shop=!1;spin=0;atss=0;dfss=0;socket=0;gauge=0;gauge_battle=0;sources=[];statFromString(e){switch(e){case"Mov Speed":return this.movement;case"Charge":return this.charge;case"Lob":return this.lob;case"Smash":return this.smash;case"Str":return this.str;case"Dex":return this.dex;case"Sta":return this.sta;case"Will":return this.wil;case"Max Str":return this.max_str;case"Max Dex":return this.max_dex;case"Max Sta":return this.max_sta;case"Max Will":return this.max_wil;case"Serve":return this.serve;case"Quickslots":return this.quickslots;case"Buffslots":return this.buffslots;case"HP":return this.hp;default:throw"Internal error"}}}r.Item=d;class u{shop_index;gacha_index;name;constructor(e,t,r){this.shop_index=e,this.gacha_index=t,this.name=r;for(const a of y)this.shop_items.set(a,new Map)}add(e,t,r,a,n){e.character&&e.character!==r&&(r=e.character),this.shop_items.get(r).set(e,[t,a,n]),this.character_probability.set(r,t+(this.character_probability.get(r)||0))}average_tries(r,e=void 0){var e=e?[e]:y,t=e.reduce((e,t)=>e+(this.shop_items.get(t).get(r)?.[0]||0),0);return 0===t?0:e.reduce((e,t)=>e+this.character_probability.get(t),0)/t}get total_probability(){return y.reduce((e,t)=>e+this.character_probability.get(t),0)}character_probability=new Map;shop_items=new Map}let k=new Map,m=(r.items=k,new Map),b=(r.shop_items=m,new Map),a;function v(e,t){let r=e.toFixed(t);for(;r.endsWith("0");)r=r.slice(0,-1);return r=r.endsWith(".")?r.slice(0,-1):r}async function p(e){var t=e.slice(e.lastIndexOf("/")+1),r=document.getElementById("loading"),r=(r instanceof HTMLElement&&(r.textContent=`Loading ${t}, please wait...`),await fetch(e)),t=document.getElementById("progressbar");return t instanceof HTMLProgressElement&&t.value++,r.ok?r.text():""}function _(e,r){e=(0,I.createHTML)(["a",{class:"popup_link"},e]);return e.addEventListener("click",e=>{var t;e instanceof MouseEvent&&(t=document.getElementById("top_div"))instanceof HTMLDivElement&&(e.stopPropagation(),a&&(a.close(),a.remove()),a=Array.isArray(r)?(0,I.createHTML)(["dialog",...r]):(0,I.createHTML)(["dialog",r]),t.appendChild(a),a.style.position="absolute",a.style.top=e.pageY+"px",a.style.left=e.pageX-300+"px",a.show())}),e}function c(e){var t,r=(0,I.createHTML)(["table",["tr",["th","Number of gachas"],["th","Chance for item"]]]);for(const n of[.1,.5,1,2,5,10]){var a=Math.round(e*n);0!==a&&r.appendChild((0,I.createHTML)(["tr",["td",{class:"numeric"},""+a],["td",{class:"numeric"},(100*(t=1/e,1-Math.pow(1-t,a))).toFixed(4)+"%"]]))}return r.appendChild((0,I.createHTML)(["tr"])),_(""+v(e,2),r)}function L(e,t){return 1===e&&1===t?"":e===t?" x "+t:` x ${e}-`+t}function l(e,t,r){var a=r?(0,I.createHTML)(["table",["tr",["th","Item"],["th","Average Tries"]]]):(0,I.createHTML)(["table",["tr",["th","Item"],["th","Character"],["th","Average Tries"]]]),n=b.get(t.shop_id);if(!n)throw"Internal error";var o,s,i,c,l=new Map;for(const g of void 0===r?y:[r]){var d=n.shop_items.get(g);if(d)for(var[u,[m,p,f]]of d){var h=u.character||r,h=h?n.character_probability.get(h):n.total_probability,m=m/h,h=l.get(u)?.[0]||0;l.set(u,[h+m,p,f])}}for([o,[s,i,c]]of l)r?a.appendChild((0,I.createHTML)(["tr",e===o?{class:"highlighted"}:"",["td",o.name_en,L(i,c)],["td",{class:"numeric"},""+v(1/s,2)]])):a.appendChild((0,I.createHTML)(["tr",e===o?{class:"highlighted"}:"",["td",o.name_en,L(i,c)],["td",o.character||"*"],["td",{class:"numeric"},""+v(1/s,2)]]));return _(t.item.name_en,[(0,I.createHTML)(["a",n.name]),a])}function f(r,e){var t=["Guardian map "+e.guardian_map,(0,I.createHTML)(["ul",{class:"layout"},["li","Items:",["ul",{class:"layout"},...e.items.reduce((e,t)=>[...e,(0,I.createHTML)(["li",{class:t===r?"highlighted":""},t.name_en])],[])]],["li","Requires boss: "+(e.need_boss?"Yes":"No")],...0<e.boss_time?[(0,I.createHTML)(["li","Boss time: "+(t=e.boss_time,Math.floor(t/60))+":"+(""+t%60).padStart(2,"0")])]:[],["li","EXP multiplier: "+e.xp]])];return _(e.guardian_map,t)}function S(o,s,i){return[...o.sources.values()].filter(s).map(e=>{var t,r=o,a=s,n=i;if(e instanceof M)return t=e.requiresGuardian?void 0:n,a=w(S(e.item,a,n)),[l(r,e,t)," x ",c(e.gachaTries(r,n)),...0<a.length?[" "]:[],...a];if(e instanceof T)return 1===e.items.length?[e.price+" "+(e.ap?"AP":"Gold")]:[function(e,t){var r=(0,I.createHTML)(["table",["tr",["th","Contents"]]]);for(const a of t.items)r.appendChild((0,I.createHTML)(["tr",a===e?{class:"highlighted"}:"",["td",a.name_en]]));return _(t.item.name_en,[(0,I.createHTML)(["a",t.item.name_en,r])])}(r,e),` ${e.price} `+(e.ap?"AP":"Gold")];if(e instanceof x)return[f(r,e)];throw"Internal error"})}function w(e){const t=[];function r(e){"string"==typeof e&&"string"==typeof t[t.length-1]?t[t.length-1]=t[t.length-1]+e:t.push(e)}let a=!0;for(const n of e)if(0===n.length)r(" ");else{a?a=!1:r(", ");for(const o of n)""!==o&&r(o)}return t}document.body.addEventListener("click",e=>{a&&a!==e.target&&(a.close(),a.remove(),a=void 0)})},{"./html":2}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.isItemSelector=d,r.itemSelectors=void 0;var I=e("./checkboxTree"),y=e("./itemLookup"),E=e("./html"),T=e("./storage");const c=["Parts",["Head",["+Hat","+Hair","Dye"],"+Upper","+Lower","Legs",["+Shoes","Socks"],"Aux",["+Hand","+Backpack","+Face"],"+Racket"]],l=["Availability",["Shop",["+Gold","+AP"],"+Allow gacha","+Guardian","+Untradable","Unavailable items"]],M=new Set;!function(){const t=document.getElementById("characterFilters");if(t){let e=!0;for(const i of["All",...y.characters]){var r="characterSelectors_"+i,a=(0,E.createHTML)(["input",{id:r,type:"radio",name:"characterSelectors",value:i}]);a.addEventListener("input",m),t.appendChild(a),t.appendChild((0,E.createHTML)(["label",{for:r},i])),t.appendChild((0,E.createHTML)(["br"])),e&&(a.checked=!0,e=!1)}var n,o;for([n,o]of[[c,"partsFilter"],[l,"availabilityFilter"]]){const t=document.getElementById(o);if(!t)return;var s=(0,I.makeCheckboxTree)(n);s.addEventListener("change",m),t.innerText="",t.appendChild(s)}}}();let o;const s=(0,E.createHTML)(["hr",{id:"dragOverBar"}]);let i;function x(){var e;for(const t of document.getElementsByName("characterSelectors")){if(!(t instanceof HTMLInputElement))throw"Internal error";if(t.checked)return e=t.value,(0,y.isCharacter)(e)?e:void 0}}document.addEventListener("dragstart",({target:e})=>{e instanceof HTMLElement&&(o=e)}),document.addEventListener("dragover",t=>{if(t.target instanceof HTMLElement){if("dropzone"===t.target.className){var r=t.target.getBoundingClientRect(),a=t.clientY-r.top,r=r.height;let e;switch((n=e=e||{})[n.above=0]="above",n[n.on=1]="on",n[n.below=2]="below",a<.3*r?e.above:.7*r<a?e.below:e.on){case e.above:i&&(i.classList.remove("drophover"),i=void 0),s.hidden=!1,t.target.before(s);break;case e.below:i&&(i.classList.remove("drophover"),i=void 0),s.hidden=!1,t.target.after(s);break;case e.on:s.hidden=!0,i&&i.classList.remove("drophover"),o!==t.target&&(i=t.target).classList.add("drophover")}}var n;t.preventDefault()}}),document.addEventListener("drop",({target:e})=>{if(s.hidden){if(s.hidden=!0,e instanceof HTMLElement){if(i){i.classList.remove("drophover");var t=i;if(i=void 0,!(t instanceof HTMLLIElement))return;t.textContent+="+"+o.textContent,o.remove()}e===o&&(t=o.textContent.split("+"),o.textContent=t.shift(),o.after(...t.map(e=>(0,E.createHTML)(["li",{class:"dropzone",draggable:"true"},e])))),m()}}else o.remove(),s.after(o),s.hidden=!0,m()});const a=["partsSelector","gachaSelector","otherItemsSelector"];function d(e){return a.includes(e)}function k(){var e=document.getElementById("partsSelector");if(e instanceof HTMLInputElement){if(e.checked)return"partsSelector";e=document.getElementById("gachaSelector");if(e instanceof HTMLInputElement){if(e.checked)return"gachaSelector";e=document.getElementById("otherItemsSelector");if(e instanceof HTMLInputElement&&e.checked)return"otherItemsSelector"}}throw"Internal error"}function u(){var e,t,r=T.Variable_storage.get_variable("Character"),a=(!function(e){for(const t of document.getElementsByName("characterSelectors")){if(!(t instanceof HTMLInputElement))throw"Internal error";if(t.value===e)return t.checked=!0}}("string"==typeof r&&(0,y.isCharacter)(r)?r:"All"),{});for([e,t]of Object.entries(T.Variable_storage.variables))"boolean"==typeof t&&(a[e]=t);r=document.getElementById("partsFilter")?.children[0];if(!(r instanceof HTMLUListElement))throw"Internal error";(0,I.setLeafStates)(r,a);r=document.getElementById("availabilityFilter")?.children[0];if(!(r instanceof HTMLUListElement))throw"Internal error";(0,I.setLeafStates)(r,a);r=document.getElementById("levelrange");if(!(r instanceof HTMLInputElement))throw"Internal error";var n=T.Variable_storage.get_variable("maxLevel"),n=(r.value="number"==typeof n?""+n:r.max,document.getElementById("nameFilter"));if(!(n instanceof HTMLInputElement))throw"Internal error";var o=T.Variable_storage.get_variable("nameFilter"),n=("string"==typeof o&&(n.value=o),document.getElementById("enchantToggle"));if(!(n instanceof HTMLInputElement))throw"Internal error";n.checked=!!T.Variable_storage.get_variable("enchantToggle");{let e=T.Variable_storage.get_variable("itemTypeSelector");"string"==typeof e&&d(e)||(e="partsSelector");o=document.getElementById(e);if(!(o instanceof HTMLInputElement))throw"Internal error";o.checked=!0,o.dispatchEvent(new Event("change",{bubbles:!1,cancelable:!0}))}n=T.Variable_storage.get_variable("excluded_item_ids");if("string"==typeof n)for(const s of n.split(","))M.add(parseInt(s));M.delete(NaN),r.dispatchEvent(new Event("input"))}function m(){var e,t,r,a,n=x()||"All";if(T.Variable_storage.set_variable("Character",n),!((n=document.getElementById("partsFilter")?.children[0])instanceof HTMLUListElement))throw"Internal error";for([e,t]of Object.entries((0,I.getLeafStates)(n)))T.Variable_storage.set_variable(e,t);if(!((n=document.getElementById("availabilityFilter")?.children[0])instanceof HTMLUListElement))throw"Internal error";for([r,a]of Object.entries((0,I.getLeafStates)(n)))T.Variable_storage.set_variable(r,a);if(!((n=document.getElementById("levelrange"))instanceof HTMLInputElement))throw"Internal error";if(n=parseInt(n.value),T.Variable_storage.set_variable("maxLevel",n),!((n=document.getElementById("nameFilter"))instanceof HTMLInputElement))throw"Internal error";if((n=n.value)?T.Variable_storage.set_variable("nameFilter",n):T.Variable_storage.delete_variable("nameFilter"),!((n=document.getElementById("enchantToggle"))instanceof HTMLInputElement))throw"Internal error";T.Variable_storage.set_variable("enchantToggle",n.checked),T.Variable_storage.set_variable("itemTypeSelector",k()),T.Variable_storage.set_variable("excluded_item_ids",Array.from(M).join(","));const o=[],s=[];let i;n=document.getElementById("partsFilter")?.children[0];if(!(n instanceof HTMLUListElement))throw"Internal error";if(!(document.getElementById("enchantToggle")instanceof HTMLInputElement))throw"Internal error";var c=document.getElementById("nameFilter");if(!(c instanceof HTMLInputElement))throw"Internal error";if(i=x(),"partsSelector"===k()&&i&&o.push(e=>e.character===i),"partsSelector"===k()){const f=(0,I.getLeafStates)(n);o.push(e=>f[e.part])}n=document.getElementById("availabilityFilter")?.children[0];if(!(n instanceof HTMLUListElement))throw"Internal error";n=(0,I.getLeafStates)(n);if(n.Gold||s.push(e=>!(e instanceof y.ShopItemSource&&!e.ap&&0<e.price)),n.AP||s.push(e=>!(e instanceof y.ShopItemSource&&e.ap&&0<e.price)),n.Untradable||o.push(e=>e.parcel_enabled),n["Allow gacha"]||s.push(e=>!(e instanceof y.GachaItemSource)),n.Guardian||s.push(e=>!e.requiresGuardian),!n["Unavailable items"]){const h=[...s];function l(e){if(t=e,h.every(e=>e(t))){var t;if(!(e instanceof y.GachaItemSource))return!0;for(const r of e.item.sources)if(l(r))return!0}return!1}s.push(l),o.push(function(e){for(const t of e.sources)if(l(t))return!0;return!1})}{n=document.getElementById("levelrange");if(!(n instanceof HTMLInputElement))throw"Internal error";const g=parseInt(n.value),b=(o.push(e=>e.level<=g),c.value);b&&o.push(e=>e.name_en.toLowerCase().includes(b.toLowerCase()))}o.push(e=>!M.has(e.id));var d=document.getElementById("itemFilter");if(!(d instanceof HTMLDivElement))throw"Internal error";d.replaceChildren();for(const v of M){var u=y.items.get(v);u&&d.appendChild((0,E.createHTML)(["div",(0,E.createHTML)(["button",{class:"item_removal_removal","data-item_index":""+v},"X"]),u.name_en]))}const m=[];n=document.getElementById("priority_list");if(!(n instanceof HTMLOListElement))throw"Internal error";const p=Array.from(n.childNodes).filter(e=>!e.textContent?.includes("\n")).filter(e=>e.textContent).map(e=>e.textContent);for(const _ of p){const L=_.split("+");m.push((t,r)=>{return e=L.map(e=>t.statFromString(e)).reduce((e,t)=>e+t),a=L.map(e=>r.statFromString(e)).reduce((e,t)=>e+t),e===a?0:e<a?-1:1;var e,a})}c=(()=>{switch(k()){case"partsSelector":return(0,y.getResultsTable)(t=>o.every(e=>e(t)),t=>s.every(e=>e(t)),(e,t)=>{if(0===e.length)return[t];for(const r of m)switch(r(e[0],t)){case-1:return[t];case 1:return e}return[...e,t]},p,i);case"gachaSelector":return(0,y.getGachaTable)(t=>o.every(e=>e(t)),i);case"otherItemsSelector":return(0,E.createHTML)(["table",["tr",["th","TODO: Other items"]]])}})(),n=document.getElementById("results");n&&(n.innerText="",n.appendChild(c))}r.itemSelectors=a;{{const f=document.getElementById("levelDisplay");if(!(f instanceof HTMLLabelElement))throw"Internal error";const h=document.getElementById("levelrange");if(!(h instanceof HTMLInputElement))throw"Internal error";h.addEventListener("input",()=>{f.textContent="Max level requirement: "+h.value,m()})}if(!((e=document.getElementById("nameFilter"))instanceof HTMLElement))throw"Internal error";e.addEventListener("input",m);const n=document.getElementById("enchantToggle");if(!(n instanceof HTMLInputElement))throw"Internal error";const p=document.getElementById("priority_list");if(!(p instanceof HTMLOListElement))throw"Internal error";n.addEventListener("input",()=>{for(const e of Array.from(p.childNodes).filter(e=>!e.textContent?.includes("\n")).filter(e=>e.textContent)){const t=n.checked?/^((?:Str)|(?:Sta)|(?:Dex)|(?:Will))$/:/^Max ((?:Str)|(?:Sta)|(?:Dex)|(?:Will))$/,r=n.checked?"Max $1":"$1";e.textContent=e.textContent.split("+").map(e=>e.replace(t,r)).join("+")}m()})}window.addEventListener("load",async()=>{{const r=document.getElementById("priority_group");if(r instanceof HTMLFieldSetElement){var e=document.getElementById("partsSelector");if(e instanceof HTMLInputElement){const a=document.getElementById("partsFilter");a instanceof HTMLDivElement&&(e.addEventListener("change",()=>{r.classList.remove("disabled"),a.classList.remove("disabled"),m()}),(e=document.getElementById("gachaSelector"))instanceof HTMLInputElement)&&(e.addEventListener("change",()=>{r.classList.add("disabled"),a.classList.add("disabled"),m()}),(e=document.getElementById("otherItemsSelector"))instanceof HTMLInputElement)&&e.addEventListener("change",()=>{r.classList.add("disabled"),a.classList.add("disabled"),m()})}}}u(),await(0,y.downloadItems)();for(const n of document.getElementsByClassName("show_after_load"))n instanceof HTMLElement&&(n.hidden=!1);for(const o of document.getElementsByClassName("hide_after_load"))o instanceof HTMLElement&&(o.style.display="none");e=document.getElementById("levelrange");if(!(e instanceof HTMLInputElement))throw"Internal error";var t=(0,y.getMaxItemLevel)(),t=(e.value=""+Math.min(parseInt(e.value),t),e.max=""+t,e.dispatchEvent(new Event("input")),m(),document.getElementById("priority_legend"));t instanceof HTMLLegendElement&&t.appendChild((0,y.createPopupLink)(" (?)",(0,E.createHTML)(["p","Reorder the stats to your liking to affect the results list.",["br"],"Drag a stat up or down to change its importance (for example drag Lob above Charge).",["br"],"Drag a stat onto another to combine them (for example Str onto Dex, the results will display Str+Dex).",["br"],"Drag a combined stat onto itself to separate them."])))}),document.body.addEventListener("click",e=>{e.target instanceof HTMLElement&&("item_removal"===e.target.className?e.target.dataset.item_index&&(M.add(parseInt(e.target.dataset.item_index)),m()):"item_removal_removal"===e.target.className&&e.target.dataset.item_index&&(M.delete(parseInt(e.target.dataset.item_index)),m()))})},{"./checkboxTree":1,"./html":2,"./itemLookup":3,"./storage":5}],5:[function(e,t,r){"use strict";function n(e){var t=e[0],r=e.substring(1);switch(t){case"s":return r;case"n":return parseFloat(r);case"b":return"1"===r}throw"invalid value: "+e}function o(e){return 1<=e.length&&"snb".includes(e[0])}Object.defineProperty(r,"__esModule",{value:!0}),r.Variable_storage=void 0;r.Variable_storage=class{static get_variable(e){e=localStorage.getItem(""+e);if("string"==typeof e&&o(e))return n(e)}static set_variable(e,t){localStorage.setItem(""+e,function(e){switch(typeof e){case"string":return"s"+e;case"number":return"n"+e;case"boolean":return e?"b1":"b0"}}(t))}static delete_variable(e){localStorage.removeItem(""+e)}static clear_all(){localStorage.clear()}static get variables(){var t={};for(let e=0;e<localStorage.length;e++){var r,a=localStorage.key(e);"string"==typeof a&&("string"==typeof(r=localStorage.getItem(a))&&o(r))&&(t[a]=n(r))}return t}}},{}]},{},[4]);
